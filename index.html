<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Humi Food - Sản phẩm gia vị</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-100">
    <header class="bg-custom-orange text-white p-4">
        <nav class="container mx-auto flex justify-center items-center">
            <div class="logo">
                <img src="humi-logo.png" alt="Logo" class="logo-image">
            </div>
        </nav>
    </header>
    <div class="container mx-auto p-6 text-center">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">Humi Food - Gia vị, nước chấm nhà làm</h1>
        <p class="text-lg text-gray-600 mb-6">Khám phá những hương vị đặc biệt của chúng tôi!</p>

        <!-- Container chung cho slide show và các phần tử khác -->
        <div class="flex flex-col md:flex-row items-center justify-center gap-4">
            <!-- Danh sách sản phẩm -->
            <div class="slideshow-container w-full md:w-1/2">
                <img id="currentSlide" src="muoi-ot-xanh.jpg" alt="Slide 1" class="slideshow-image">
                <p id="productName" class="text-center mt-4 mb-2 text-2xl font-bold text-gray-800 mx-auto">Muối Ớt Xanh</p>
                <p id="productDescription" class="text-center mb-8 text-lg text-gray-600 mx-auto">Một sản phẩm độc đáo với hương vị tươi mát, phù hợp với hải sản.</p>
                <p id="productPrice" class="text-2xl font-bold text-blue-500">Giá: 100,000 VND</p>
            </div>

            <!-- Thông tin cảnh báo an toàn và hướng dẫn bảo quản -->
            <div class="w-full md:w-1/2 space-y-4">
                <div class="p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700">
                    <h3 class="text-xl font-semibold mb-2">Thông tin cảnh báo an toàn</h3>
                    <p>Sản phẩm có thành phần sữa, đậu nành, dầu cá. Không sử dụng sản phẩm hết hạn sử dụng, hoặc dị ứng với bất kỳ thành phần của sản phẩm.</p>
                </div>

                <div class="p-4 bg-green-100 border-l-4 border-green-500 text-green-700">
                    <h3 class="text-xl font-semibold mb-2">Hướng dẫn bảo quản</h3>
                    <p>Hạn sử dụng 3 tháng. Bảo quản nơi khô, mát, tránh ánh nắng trực tiếp, đậy kín sau khi sử dụng. Nên bảo quản trong ngăn mát tủ lạnh và nên sử dụng trong vòng 30 ngày sau khi mở nắp.</p>
                </div>

                <!-- Nút Mua Hàng -->
                <button class="bg-blue-500 text-white px-6 py-3 mt-6 rounded-lg shadow hover:bg-blue-700"
                        onclick="openForm()">
                    Mua hàng
                </button>
            </div>
        </div>
    </div>

    <!-- Form đặt hàng -->
    <div id="formPopup" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center">
        <div id="formContainer" class="bg-white p-6 rounded-lg shadow-lg w-11/12 md:w-3/5 lg:w-1/3 relative">
            <button class="absolute top-3 right-3 text-gray-600 hover:text-gray-800 text-2xl"
                    onclick="closeForm()">&times;</button>
            <h2 class="text-2xl font-semibold mb-4">Đặt hàng</h2>
            <div class="overflow-y-auto max-h-[70vh] p-2">
                <form id="orderForm">
                    <input type="text" id="name" placeholder="Họ và tên" required class="w-full p-2 border rounded mb-3">
                    <input type="tel" id="phone" placeholder="Số điện thoại" required class="w-full p-2 border rounded mb-3">

                    <select id="province" required onchange="updateDistricts()" class="w-full p-2 border rounded mb-3">
                        <option value="">Chọn tỉnh/thành phố</option>
                    </select>

                    <select id="district" required onchange="updateWards()" class="w-full p-2 border rounded mb-3">
                        <option value="">Chọn quận/huyện</option>
                    </select>

                    <select id="ward" required class="w-full p-2 border rounded mb-3">
                        <option value="">Chọn phường/xã</option>
                    </select>

                    <input type="text" id="address" placeholder="Địa chỉ chi tiết" required class="w-full p-2 border rounded mb-3">

                    <h3 class="font-semibold text-lg mb-3">Chọn sản phẩm</h3>

                    <div class="mb-3">
                        <label class="flex items-center">
                            <input type="checkbox" name="product" value="Muối Ớt Xanh" onchange="toggleQuantity(this)" class="mr-2">
                            Muối Ớt Xanh - 100,000 VND
                        </label>
                        <input type="number" name="quantity" data-product="Muối Ớt Xanh" min="1" class="w-full p-2 border rounded quantity-input">
                    </div>

                    <div class="mb-3">
                        <label class="flex items-center">
                            <input type="checkbox" name="product" value="Sốt Thai" onchange="toggleQuantity(this)" class="mr-2">
                            Sốt Thái - 100,000 VND
                        </label>
                        <input type="number" name="quantity" data-product="Sốt Thai" min="1" class="w-full p-2 border rounded quantity-input">
                    </div>

                    <div class="mb-3">
                        <label class="flex items-center">
                            <input type="checkbox" name="product" value="Muối Ớt Đỏ" onchange="toggleQuantity(this)" class="mr-2">
                            Muối Ớt Đỏ - 100,000 VND
                        </label>
                        <input type="number" name="quantity" data-product="Muối Ớt Đỏ" min="1" class="w-full p-2 border rounded quantity-input">
                    </div>

                    <div class="mb-3">
                        <label class="flex items-center">
                            <input type="checkbox" name="product" value="Combo 3 vị" onchange="toggleQuantity(this)" class="mr-2">
                            Combo 3 vị - 200,000 VND
                        </label>
                        <input type="number" name="quantity" data-product="Combo 3 vị" min="1" class="w-full p-2 border rounded quantity-input">
                    </div>

                    <p class="text-lg font-bold mt-4">Tổng tiền: <span id="totalAmount" class="text-red-500">0</span> VND</p>

                    <div class="flex justify-between mt-4">
                        <button type="button" class="bg-gray-400 text-white w-1/2 py-2 rounded-lg shadow mr-2"
                                onclick="closeForm()">
                            Đóng
                        </button>
                        <button type="submit" class="bg-blue-500 text-white w-1/2 py-2 rounded-lg shadow">
                            Gửi đơn hàng
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function openForm() {
            document.getElementById("formPopup").classList.remove("hidden");
        }

        function closeForm() {
            document.getElementById("formPopup").classList.add("hidden");
        }

        function toggleQuantity(checkbox) {
            let quantityInput = checkbox.closest("div").querySelector("input[type='number']");
            if (checkbox.checked) {
                quantityInput.value = 1;
            } else {
                quantityInput.value = "";
            }
            calculateTotal();
        }

        async function fetchProvinces() {
            const response = await fetch("https://provinces.open-api.vn/api/p/");
            const provinces = await response.json();
            const provinceSelect = document.getElementById("province");

            provinces.forEach(province => {
                let option = document.createElement("option");
                option.value = province.code;
                option.textContent = province.name;
                provinceSelect.appendChild(option);
            });
        }

        async function updateDistricts() {
            const provinceCode = document.getElementById("province").value;
            const districtSelect = document.getElementById("district");
            const wardSelect = document.getElementById("ward");

            districtSelect.innerHTML = '<option value="">Chọn quận/huyện</option>';
            wardSelect.innerHTML = '<option value="">Chọn phường/xã</option>';

            if (!provinceCode) return;

            const response = await fetch(`https://provinces.open-api.vn/api/p/${provinceCode}?depth=2`);
            const data = await response.json();

            data.districts.forEach(district => {
                let option = document.createElement("option");
                option.value = district.code;
                option.textContent = district.name;
                districtSelect.appendChild(option);
            });
        }

        async function updateWards() {
            const districtCode = document.getElementById("district").value;
            const wardSelect = document.getElementById("ward");

            wardSelect.innerHTML = '<option value="">Chọn phường/xã</option>';

            if (!districtCode) return;

            const response = await fetch(`https://provinces.open-api.vn/api/d/${districtCode}?depth=2`);
            const data = await response.json();

            data.wards.forEach(ward => {
                let option = document.createElement("option");
                option.value = ward.code;
                option.textContent = ward.name;
                wardSelect.appendChild(option);
            });
        }

        fetchProvinces();

        document.getElementById("orderForm").addEventListener("submit", async function(event) {
            event.preventDefault();

            // Kiểm tra xem có sản phẩm nào được chọn không
            const selectedProducts = document.querySelectorAll("#orderForm input[name='product']:checked");
            if (selectedProducts.length === 0) {
                alert("Vui lòng chọn ít nhất một sản phẩm trước khi gửi đơn hàng.");
                return; // Dừng lại nếu không có sản phẩm nào được chọn
            }

            // Kiểm tra định dạng số điện thoại
            const phoneNumber = document.getElementById("phone").value;
            if (!isValidPhoneNumber(phoneNumber)) {
                alert("Vui lòng nhập số điện thoại hợp lệ (10 chữ số, bắt đầu bằng số 0).");
                return; // Dừng lại nếu số điện thoại không hợp lệ
            }

            let formData = new FormData();
            formData.append("entry.1604370799", document.getElementById("name").value); // Họ và tên
            formData.append("entry.1857318765", phoneNumber); // Số điện thoại
            formData.append("entry.1168596579", document.getElementById("province").options[document.getElementById("province").selectedIndex].text); // Tỉnh
            formData.append("entry.1366742007", document.getElementById("district").options[document.getElementById("district").selectedIndex].text); // Huyện
            formData.append("entry.1295072366", document.getElementById("ward").options[document.getElementById("ward").selectedIndex].text); // Xã
            formData.append("entry.864847777", document.getElementById("address").value); // Địa chỉ

            let selectedProductsList = [];
            const total = calculateTotal(); // Gọi hàm để tính tổng tiền

            selectedProducts.forEach((product) => {
                const quantityInput = document.querySelector(`input[data-product="${product.value}"]`);
                let quantity = parseInt(quantityInput.value) || 0;
                if (quantity > 0) {
                    selectedProductsList.push(`${product.value} (x${quantity})`);
                }
            });

            formData.append("entry.850809316", selectedProductsList.join(", ")); // Danh sách sản phẩm
            formData.append("entry.459592621", total.toString()); // Tổng tiền

            let googleFormURL = "https://docs.google.com/forms/d/e/1FAIpQLSf00hzyTvlrk8kNIdw9l4dmi3RXlgTxwGy4tn1uG_t36_D18A/formResponse";

            let response = await fetch(googleFormURL, {
                method: "POST",
                body: formData,
                mode: "no-cors"
            });

            alert("Đặt hàng thành công!");
            closeForm();
        });

        function calculateTotal() {
            let total = 0;
            document.querySelectorAll("input[name='product']:checked").forEach((product) => {
                let quantityInput = document.querySelector(`input[data-product="${product.value}"]`);
                let quantity = parseInt(quantityInput.value) || 0;
                let price = product.value === "Combo 3 vị" ? 200000 : 100000;
                total += quantity * price;
            });

            document.getElementById("totalAmount").textContent = total.toLocaleString();
            return total; // Trả về giá trị tổng tiền
        }

        document.querySelectorAll("input[name='quantity']").forEach(input => {
            input.addEventListener("input", function () {
                validateQuantity(input);
                calculateTotal();
            });
        });

        // Hàm kiểm tra định dạng số điện thoại
        function isValidPhoneNumber(phoneNumber) {
            const phoneRegex = /^(0)(3[2-9]|5[2689]|7[06-9]|8[1-9]|9[0-9])[0-9]{7}$/;
            return phoneRegex.test(phoneNumber);
        }

        // Hàm kiểm tra số lượng
        function validateQuantity(inputElement) {
            const quantity = parseInt(inputElement.value) || 0;
            if (quantity < 0) {
                inputElement.setCustomValidity("Số lượng phải lớn hơn hoặc bằng 0.");
            } else if (quantity > 10) {
                inputElement.setCustomValidity("Số lượng phải lớn hơn hoặc bằng 0 và nhỏ hơn 10.");
            } else {
                inputElement.setCustomValidity(""); // Reset lỗi nếu giá trị hợp lệ
            }
        }

        // Danh sách các hình ảnh và mô tả cho slideshow
        const slides = [
            "muoi-ot-xanh.jpg",
            "sot-thai.jpg",
            "muoi-ot-do.jpg",
	    "combo.jpg"
        ];

        const productNames = [
            "Muối Ớt Xanh",
            "Sốt Thái",
            "Muối Ớt Đỏ",
            "Combo 3 loại"
        ];

        const productDescriptions = [
            "Một sản phẩm độc đáo với hương vị tươi mát, phù hợp với hải sản.",
	    "Hương vị đặc trưng của Thái Lan, hoàn hảo cho việc làm sốt chấm. ",
	    "Cay nồng, phù hợp để làm sốt chấm và cũng có thể làm gia vị chế biến món ăn.",
	    "Combo 3 vị nhưng tính tiền 2 để mọi người có thể trải nghiệm đủ vị."	
        ];
	const productPrices = [
            "Giá 100,000 VNĐ",
            "Giá 100,000 VNĐ",
            "Giá 100,000 VNĐ",
            "Giá 200,000 VNĐ"
        ];
        let currentIndex = 0;
        const currentSlide = document.getElementById("currentSlide");
        const productName = document.getElementById("productName");
        const productDescription = document.getElementById("productDescription");
	 const productPrice = document.getElementById("productPrice");

        // Hàm hiển thị slide tiếp theo
        function showNextSlide() {
            currentIndex = (currentIndex + 1) % slides.length;
            currentSlide.src = slides[currentIndex];
            productName.textContent = productNames[currentIndex];
            productDescription.textContent = productDescriptions[currentIndex];
            productPrice.textContent = productPrices[currentIndex];		
        }

        // Tự động chuyển slide mỗi 2 giây
        setInterval(showNextSlide, 2000);
    </script>
</body>
</html>
